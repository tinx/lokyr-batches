swagger: "2.0"
produces:
  - "application/json"
consumes:
  - "application/json"
schemes: "https"
basePath: "/v1/"
security:
  type: "basic"
  description: "HTTP Basic Authentication with pre-shared credentials."
info:
  title: "Lokyr Batches"
  description: "This services manages production and ingredient batches."
  version: "1.0.0"
  contact:
    name: "Lokyr Support"
    email: "info@lokyr.com"
  license:
    name: "Apache 2.0"
    url: "http://www.apache.org/licenses/LICENSE-2.0.html"
paths:
  "/batch/production":
    post:
      operationId: "productionBatchCreate"
      summary: "Add a new production batch"
      description: |
        Create a new production batch record and insert it into the
        database. The initial status will be 'setup'.
      parameters:
        - name: "body"
          in: "body"
          description: "Batch production object."
          required: true
          schema:
            $ref: '#/definitions/productionBatch'
      responses:
        200:
          description: "successful operation"
          schema:
            $ref: "#/definitions/productionBatch"
        400:
          description: "Invalid batch size supplied."
        404:
          description: "productTypeId not found."
    get:
      operationId: "productionBatchList"
      summary: "Return all production batches that the user has access to."
      description: |
        This returns a list of production batches. There is no
        pagination. The entire list will be returned in one response.
      parameters: []
      responses:
        200:
          description: "successful operation"
          schema:
            type: "array"
            items:
              $ref: "#/definitions/productionBatch"
  "/batch/production/{batchId}":
    delete:
      operationId: "productionBatchDelete"
      summary: "Delete the referenced production batch from the database."
      description: |
        Removes the record of the production batch. This operation
        is only possible if there are no other records linked to
        this one.

        If any inspection reports, documents, split batches or other
        records reference a production batch, it can not be deleted.
      parameters:
        - name: "batchId"
          in: "path"
          description: "ID of the batch to delete."
          required: true
          type: "integer"
          format: "int64"
      responses:
        200:
          description: "successful operation"
        400:
          description: "invalid ID supplied"
        404:
          description: "batch not found"
definitions:
  productionBatch:
    type: "object"
    required:
      - productTypeId
      - size
    properties:
      id:
        type: "integer"
        format: "int64"
        description: "ID of this production batch."
        readOnly: true
      productTypeId:
        type: "integer"
        format: "int64"
        description: "ID of the type of product to be produced."
      name: "size"
        type: "integer"
        format: "int64"
        description: "Size of the production batch, in liters."
      status:
        type: "string"
        description: "Production status of this batch."
        enum:
          - "setup"
          - "fermenting"
          - "partially filtered"
          - "filtered"
          - "ready for bottling"
          - "bottled"
          - "gone"
        readOnly: true
      bottlingDate:
        type: "string"
        format: "date"
        description: |
          Date of bottling of this production batch. Note that batches
          can't be partially bottled. Split the batch before bottling
          if you aren't bottling the entire volume.
        readOnly: true
      bestBeforeDate:
        type: "string"
        format: "date"
        description: |
          Guaranteed 'best before' date for the bottled product. Note that
          the best before date will only be set for batches that have been
          bottled.
        readOnly: true
      alcoholContent:
        type: "number"
        format: "float"
        description: |
          Alcohol content (in percent per volume) of the production batch
          when it was bottled. The alcohol content at other times during
          the production process can be recorded as a measurement entry.
        readOnly: true

